<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta property="og:title" content="Para mi princesa IVL üíé" />
  <meta property="og:description" content="Un rinc√≥n solo nuestro. √Åbrelo con el peque√±o secreto. üíå" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="/fotos/teamo.jpg" />
  <meta property="og:url" content="https://TU-DOMINIO.vercel.app/" />
  <meta name="twitter:card" content="summary_large_image" />
  <title>Para mi princesa IVL üíé</title>
  <meta name="theme-color" content="#ff6b9a" />
  <style>
    :root{--bg1:#fff0f5;--bg2:#ffe3ec;--accent:#ff6b9a;--text:#3a2a2a;--ok:#22c55e;--error:#ef4444}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";color:var(--text);background:radial-gradient(1200px 800px at 50% -20%, var(--bg2), var(--bg1));overflow:hidden}
    .center{position:fixed;inset:0;display:grid;place-items:center;padding:24px}
    .card{width:min(560px,92vw);background:#fff;border-radius:24px;box-shadow:0 10px 30px rgba(0,0,0,.08);padding:28px;text-align:center;transition:transform .25s,box-shadow .25s;animation:floaty 4s ease-in-out infinite}
    @keyframes floaty{50%{transform:translateY(-4px)}}
    .title{font-size:clamp(20px,3.6vw,28px);margin:6px 0 14px}
    .subtitle{opacity:.8;font-size:clamp(14px,2.8vw,16px);margin-bottom:18px}
    .row{display:flex;gap:10px;align-items:center;justify-content:center}
    input[type="password"]{flex:1;min-width:0;appearance:none;border:2px solid #ffd2e0;outline:none;border-radius:14px;padding:14px 16px;font-size:18px;letter-spacing:3px;text-align:center;transition:border-color .2s, box-shadow .2s;animation:glow 3s ease-in-out infinite}
    @keyframes glow{50%{box-shadow:0 0 0 6px #ff6b9a22}}
    input[type="password"]:focus{border-color:var(--accent);box-shadow:0 0 0 4px #ff6b9a22}
    button{background:var(--accent);color:#fff;border:none;padding:14px 18px;border-radius:14px;font-weight:700;font-size:16px;cursor:pointer;transition:transform .1s,filter .2s}
    button:active{transform:translateY(1px)}
    .hint{font-size:12px;opacity:.7;margin-top:10px}
    .err{color:var(--error);font-weight:600;min-height:22px;margin-top:10px}
    .shake{animation:shake .28s linear}
    @keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-7px)}40%{transform:translateX(7px)}60%{transform:translateX(-4px)}80%{transform:translateX(4px)}}
    #app{position:fixed;inset:0;display:none}

    /* Carta estilo cuadr√≠cula */
    .message{position:relative;z-index:2;width:min(820px,92vw);margin:8vh auto 0;padding:32px;background:#fff;border-radius:16px;box-shadow:0 10px 25px rgba(0,0,0,.08);line-height:1.7;font-size:clamp(15px,3vw,18px);white-space:pre-wrap;background-image:linear-gradient(transparent 23px,#f3f3f3 24px),linear-gradient(90deg,transparent 23px,#f3f3f3 24px);background-size:100% 24px,24px 100%;background-position:0 10px,10px 0;padding-left:88px;max-height:calc(100vh - 22vh);overflow:auto;overscroll-behavior:contain;scroll-behavior:smooth;-webkit-overflow-scrolling:touch;padding-right:10px}
    .message h1{font-size:clamp(26px,6vw,40px);margin:0 0 16px;color:#c2185b}
    .typing{border-right:2px solid #c2185b;white-space:pre-wrap;overflow:hidden}
    .message::-webkit-scrollbar{width:10px}
    .message::-webkit-scrollbar-thumb{background:#ffd2e0;border-radius:999px}
    .message::-webkit-scrollbar-track{background:transparent}

    /* L√≠nea roja + sellito */
    .message::before{content:"";position:absolute;top:0;bottom:0;left:56px;width:2px;background:#ff9cb8aa;pointer-events:none}
    .message::after{content:"Para Isa üíå";position:absolute;top:10px;right:14px;font-size:12px;letter-spacing:.5px;opacity:.5}
    @media (max-width:480px){.message{padding-left:72px}}

    .layer{position:fixed;inset:0;pointer-events:none;overflow:hidden}
    .heart,.photo{position:fixed;top:-10vh;will-change:transform,opacity}
    .heart{font-size:24px;text-shadow:0 6px 14px rgba(0,0,0,.15)}
    .photo{box-shadow:0 12px 24px rgba(0,0,0,.15);overflow:hidden;-webkit-clip-path:path('M 50% 10% C 35% -5%, 0% 15%, 50% 60% C 100% 15%, 65% -5%, 50% 10% Z');clip-path:path('M 50% 10% C 35% -5%, 0% 15%, 50% 60% C 100% 15%, 65% -5%, 50% 10% Z')}
    @keyframes fall{to{transform:translateY(112vh) rotate(var(--rot,0deg));opacity:var(--endOpacity,.9)}}
    @keyframes sway{50%{transform:translateY(54vh) translateX(var(--dx,40px)) rotate(var(--rot,18deg))}}

    .restart{position:fixed;right:16px;bottom:16px;z-index:4;background:rgba(255,255,255,.85);backdrop-filter:blur(6px);border:2px solid #ffd2e0;border-radius:999px;padding:10px 14px;font-weight:700;color:#3a2a2a}
    @media (prefers-reduced-motion:reduce){.heart,.photo{animation:none!important}}

    .hints{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:10px}
    .badge{border:1px dashed #ffb3c6;border-radius:999px;padding:6px 10px;font-size:12px;opacity:.9}

    .inline-pic{display:block;margin:18px auto 6px;max-width:88%;border-radius:16px;box-shadow:0 10px 24px rgba(0,0,0,.12);transition:opacity .5s ease, transform .5s ease}
    .hidden{opacity:0;transform:scale(.98)}
    .show{opacity:1;transform:scale(1)}

    /* Bot√≥n audio */
    .audio-toggle{position:fixed;left:16px;bottom:16px;z-index:4;background:rgba(255,255,255,.9);border:2px solid #ffd2e0;border-radius:999px;padding:10px 14px;font-weight:700;color:#3a2a2a;cursor:pointer}
  </style>
</head>
<body>
  <!-- Audio de fondo -->
  <audio id="bgm" src="/cancion/Afuera-del-Planeta.mp3" preload="auto" loop></audio>
  <button id="audioToggle" class="audio-toggle" title="M√∫sica">üîä</button>

  <div class="center" id="gate">
    <div class="card" id="card">
      <div style="font-size:40px">üîêü©µ</div>
      <h2 class="title">Primero un peque√±o secreto</h2>
      <p class="subtitle">Escribe la contrase√±a y toca ‚ÄúAbrir‚Äù.</p>
      <form class="row" id="form">
        <input id="pwd" type="password" inputmode="numeric" autocomplete="off" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="10" aria-label="Contrase√±a" />
        <button type="submit">Abrir</button>
      </form>
      <div class="hints" id="hints"></div>
      <div class="err" id="error" role="alert" aria-live="polite"></div>
    </div>
  </div>

  <main id="app" aria-live="polite">
    <div class="layer" id="hearts"></div>
    <div class="layer" id="photos"></div>

    <section class="message">
      <h1>Para mi ni√±a hermosa y encantadora ü©µ</h1>
      <div id="letter" class="typing"></div>
      <img id="inlinePic" class="inline-pic hidden" alt="Nosotros">
    </section>

    <button class="restart" id="restart" title="Volver al inicio">‚Ü∫ Reiniciar</button>
  </main>

  <script>
    // === Config ===
    const PHOTO_SOURCES = ["/fotos/1.jpg","/fotos/2.jpg","/fotos/3.jpg","/fotos/4.jpg","/fotos/5.jpg","/fotos/6.jpg","/fotos/7.jpg","/fotos/8.jpg"];
    const HINTS = [{label:'Pista 1: D√≠a en que nos conocimos'},{label:'Pista 2: Nuestro primer beso'},{label:'Pista 3: D√≠a en que nos hicimos novios'}];
    const EXPECTED_SEQ = ["6","8","21"];
    const HEARTS_PER_MIN = 300, PHOTOS_PER_MIN = 28, MAX_LIVE_HEARTS = 120, MAX_LIVE_PHOTOS = 20;

    // === DOM ===
    const gate = document.getElementById('gate');
    const app = document.getElementById('app');
    const form = document.getElementById('form');
    const pwd = document.getElementById('pwd');
    const err = document.getElementById('error');
    const card = document.getElementById('card');
    const heartsLayer = document.getElementById('hearts');
    const photosLayer = document.getElementById('photos');
    const restartBtn = document.getElementById('restart');
    const hintsBox = document.getElementById('hints');
    const letterBox = document.getElementById('letter');
    const messageEl = document.querySelector('.message');
    const inlinePic = document.getElementById('inlinePic');

    // === Audio ===
    const bgm = document.getElementById('bgm');
    const audioToggle = document.getElementById('audioToggle');
    bgm.volume = 0.6;

    // Desbloqueo por primer gesto (iOS/Safari)
    let audioUnlocked = false;
    function unlockAudio(){
      if (audioUnlocked) return;
      const AudioCtx = window.AudioContext || window.webkitAudioContext;
      try {
        const ctx = new AudioCtx();
        if (ctx.state === 'suspended') ctx.resume();
      } catch(e){}
      bgm.play().then(()=>{
        audioUnlocked = true;
        audioToggle.textContent = 'üîà';
        console.log('[bgm] Reproduciendo tras gesto.');
        window.removeEventListener('pointerdown', unlockAudio, {once:true});
        window.removeEventListener('touchstart', unlockAudio, {once:true});
        window.removeEventListener('click', unlockAudio, {once:true});
      }).catch(err=>console.warn('[bgm] Fall√≥ unlockAudio:', err));
    }
    window.addEventListener('pointerdown', unlockAudio, {once:true});
    window.addEventListener('touchstart', unlockAudio, {once:true});
    window.addEventListener('click', unlockAudio, {once:true});

    audioToggle.addEventListener('click', ()=>{
      if (bgm.paused){
        bgm.play().then(()=> audioToggle.textContent='üîà').catch(err=>console.warn('[bgm] play() desde bot√≥n:',err));
      } else {
        bgm.pause(); audioToggle.textContent='üîä';
      }
    });

    // Logs √∫tiles
    bgm.addEventListener('canplaythrough', ()=>console.log('[bgm] canplaythrough OK'));
    bgm.addEventListener('error', ()=>console.error('[bgm] ERROR cargando audio:', bgm.currentSrc||bgm.src));

    // === Pistas (sin n√∫meros) ===
    (function renderHints(){
      hintsBox.innerHTML = '';
      HINTS.forEach(h=>{
        const b=document.createElement('span');
        b.className='badge'; b.textContent=h.label;
        hintsBox.appendChild(b);
      });
    })();

    // === Login ===
    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      const raw = (pwd.value||'').trim();
      const digits = raw.replace(/[^0-9]+/g,'-').replace(/^-+|-+$/g,'').split('-').filter(Boolean);
      const flat = raw.replace(/\D/g,'');
      const ok = (digits.length===3 && digits[0]===EXPECTED_SEQ[0] && digits[1]===EXPECTED_SEQ[1] && digits[2]===EXPECTED_SEQ[2]) || flat===EXPECTED_SEQ.join('');
      if(ok){
        showApp();
        setTimeout(()=>{pwd.value='';},200);
      }else{
        err.textContent='Esa no es üòÖ';
        card.classList.remove('shake'); void card.offsetWidth; card.classList.add('shake');
      }
    });

    restartBtn.addEventListener('click', ()=>{
      stopRain();
      app.style.display='none';
      gate.style.display='grid';
      err.textContent='';
      pwd.focus();
      // parar m√∫sica
      bgm.pause(); audioToggle.textContent='üîä';
    });

    function showApp(){
      gate.style.display='none';
      app.style.display='block';
      startRain();
      // Intento de reproducir tras interacci√≥n v√°lida
      bgm.play().then(()=>{audioToggle.textContent='üîà';}).catch(err=>console.warn('[bgm] play() al abrir fall√≥:',err));
      typeLetter();
    }

    // === Lluvia ===
    let heartTimer=null, photoTimer=null;
    function startRain(){
      const heartsInterval = Math.max(80, 60000/HEARTS_PER_MIN);
      const photosInterval = Math.max(500, 60000/PHOTOS_PER_MIN);
      heartTimer=setInterval(()=>{ if(document.querySelectorAll('.heart').length<MAX_LIVE_HEARTS) spawnHeart(); }, heartsInterval);
      photoTimer=setInterval(()=>{ if(PHOTO_SOURCES.length && document.querySelectorAll('.photo').length<MAX_LIVE_PHOTOS) spawnPhoto(); }, photosInterval);
      for(let i=0;i<18;i++) setTimeout(spawnHeart, i*90);
      for(let i=0;i<6;i++) setTimeout(spawnPhoto, 300+i*220);
    }
    function stopRain(){ clearInterval(heartTimer);heartTimer=null; clearInterval(photoTimer);photoTimer=null; document.querySelectorAll('.heart,.photo').forEach(el=>el.remove()); }
    function spawnHeart(){
      const h=document.createElement('div'); h.className='heart';
      h.textContent = Math.random()<.2 ? 'üíé' : (Math.random()<.5 ? 'ü©µ' : 'ü¶•');
      const size=rand(16,42);
      h.style.left=rand(-5,100)+'vw'; h.style.fontSize=size+'px'; h.style.opacity=rand(60,95)/100;
      h.style.setProperty('--rot',(Math.random()<.5?-1:1)*rand(8,20)+'deg');
      const dur=rand(8,16)*100; h.style.animation=`fall ${dur/100}s linear forwards`;
      heartsLayer.appendChild(h); h.addEventListener('animationend',()=>h.remove());
    }
    function spawnPhoto(){
      const src=PHOTO_SOURCES[Math.floor(Math.random()*PHOTO_SOURCES.length)];
      const img=document.createElement('img'); img.className='photo'; img.src=src;
      const w=rand(70,130); img.style.width=w+'px'; img.style.left=rand(-8,92)+'vw'; img.style.opacity=rand(85,98)/100;
      const drift=(Math.random()<.5?-1:1)*rand(20,80)+'px'; const rot=(Math.random()<.5?-1:1)*rand(10,30)+'deg';
      img.style.setProperty('--dx',drift); img.style.setProperty('--rot',rot);
      const dur=rand(9,18)*100; img.style.animation=`fall ${dur/100}s linear forwards, sway ${dur/200}s ease-in-out infinite alternate`;
      photosLayer.appendChild(img); img.addEventListener('animationend',()=>img.remove());
    }
    function rand(min,max){return Math.floor(Math.random()*(max-min+1))+min}

    // === Carta ===
    const LETTER_TEXT = `Quer√≠a dejarte esto aqu√≠, en un rinc√≥n solo nuestro. A veces me quedo pensando en c√≥mo cambi√≥ todo desde ese primer d√≠a: lo ordinario empez√≥ a tener brillo; cada segundo que paso junto a ti se ha convertido en mi hogar. Tus brazos son mi refugio y tus besos son ese elixir que llena de alegr√≠a mi alma. Te llevo constantemente en mis pensamientos y no puedo dejar de sonre√≠r por cosas peque√±as que me recuerdan a ti: tu risa, tu manera de mirarme con tanto amor y ternura, me haces sentir que soy el hombre m√°s afortunado, y me encanta la forma en que, sin planearlo, hemos podido conectar.

No s√© si existe una palabra exacta para todo esto que siento, pero s√© reconocerlo en cada abrazo y en cada silencio c√≥modo contigo. Me haces querer ser mejor sin exig√≠rmelo, y eso para m√≠ lo dice todo. Gracias por tu paciencia conmigo ‚Äîs√© que a veces tambi√©n puedo ser dif√≠cil‚Äî, gracias por tu autenticidad, por hacer del lugar m√°s simple un lugar bonito solo porque est√°s y sobre todo gracias por saberme valorar y amarme.

Quiero seguir sumando d√≠as a tu lado: los tranquilos en la cama viendo series y comiendo, los que improvisamos cada fin de semana, los que nos hacen re√≠r. Si alg√∫n d√≠a te entra la duda, vuelve a leer esto: te elijo hoy y te voy a elegir ma√±ana. Me haces feliz, Mi Amorcito. ¬°Muchisimooooo!

Con mucho amor,
Tu rastudito fastidioso, intenso y empalagoso ü¶•`;

    // GIF al FINAL
    inlinePic.src = "/fotos/beso.gif";
    const _pre = new Image(); _pre.src = inlinePic.src;

    function typeLetter(){
      letterBox.textContent = '';
      let i = 0;
      (function type(){
        if(i < LETTER_TEXT.length){
          letterBox.textContent += LETTER_TEXT.charAt(i++);
          if(messageEl) messageEl.scrollTop = messageEl.scrollHeight;
          setTimeout(type, 40); // un poquito m√°s lento
        }else{
          letterBox.classList.remove('typing');
          if(inlinePic.classList.contains('hidden')){
            inlinePic.classList.remove('hidden');
            inlinePic.classList.add('show');
            if(messageEl) messageEl.scrollTop = messageEl.scrollHeight;
          }
        }
      })();
    }

    // Acceso r√°pido Enter
    pwd.addEventListener('keyup', e=>{ if(e.key==='Enter') form.requestSubmit(); });
  </script>
</body>
</html>
